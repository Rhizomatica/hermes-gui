<!-- <div class="alert" i18n="nomessage" *ngIf="noMessage">Alert: cannot access this message<br /></div> -->
<loading [loading]="loading"></loading>

<div *ngIf="message" class="messages">
    <h3><span *ngIf="message.secure"><img class="inlineicon" src="assets/svg/lock.svg" /></span>
        {{message.name}}</h3>
    <div class="formdata" *ngIf="message.secure && uncrypted === false">
        <p i18n="@@encryptedmessage">Encrypted message, type the password:</p>
        <p class="alert" *ngIf="wrongPass" i18n="@@ewrongpassword">wrong password, please try again</p>
        <form #e="ngForm" id="secureform" novalidate>
            <input name="pass" type="password" ngModel required>
            <button type="submit" class="m-t-10" (click)="sendPassword(message.id,e)" i18n="@@verifyPswd">check
                password</button>
        </form>
    </div>
    <div class="date"></div>
    <div class="messagebody" *ngIf="!message.secure || uncrypted">
        <p>{{message.text}}</p>
        <div *ngIf="message.file">
            <a target="_new" href="{{url}}/file/{{message.fileid}}{{message.secure ? passString : ''}}">
                <div
                    *ngIf="(fileAttr && fileAttr.isImage && !message.secure) || (fileAttr && fileAttr.isImage && message.secure && uncrypted)">
                    <img id="image" class="messageImg"
                        src="{{url}}/file/{{message.fileid}}{{message.secure ? passString : ''}}" />
                </div>
                <div *ngIf="fileAttr && fileAttr.isAudio">
                    <player [playing]="'false'" [mimetype]="message.mimetype" [fileId]="message.fileid" [url]="url"
                        [secured]="message.secure" [password]="passString"></player>

                </div>
            </a>
            <button (click)="rotateImage()" class="pull-right" *ngIf="(fileAttr && fileAttr.isImage && !message.secure) || (fileAttr && fileAttr.isImage && message.secure && uncrypted)">
                <img title="rotate" src="assets/svg/redo.svg">
            </button>
            <a target="_new" href="{{url}}/file/{{message.fileid}}{{message.secure ? passString : ''}}">
                {{message.file}}
            </a>
        </div>
    </div>
    <hr />
    <div *ngIf="!noMessage">
        <small>
            <p class="msginf" i18n="@@Origin">Origin: {{message.orig}}</p>
            <p class="msginf" i18n="@@desnitation">Destination: {{message.dest}}</p>
            <p class="msgdate" i18n="@@sentat">Sent at: {{message.sent_at}}</p>
        </small>
    </div>
    <div class="flex m-t-25" *ngIf="allowCompose">
        <button (click)="showDelete(message)" [hidden]="currentUser.admin !== 1">
            <span i18n="@@deleteMessageDetail">
                <img title="delete" src="assets/svg/trash-alt.svg">
                delete
            </span>
        </button>
        <button class="m-l-10" routerLink="/response/{{message.orig}}">
            <span i18n="@@replymessage">
                <img title="reply" src="assets/svg/reply-solid.svg">
                reply
            </span>
        </button>
    </div>

    <div class="overall alert" *ngIf="deleteMessage">
        <div class="cv">
            <span i18n="@@areyousuredeletemsgdetail">Are you sure you want to delete this message? <br /><br />
            </span>
            <span>{{selectedMessage.name}}</span>
            <div class="icon">
                <a (click)="showDelete()">
                    <img title="cancel" src="assets/svg/x.svg">
                    <button i18n="@@cancelmt">cancel</button>
                </a>
            </div>
            <div class="icon">
                <img title="confirm" src="assets/svg/trash-alt.svg">
                <button (click)="deleteThisMessage()" i18n="@@confirmmt">confirm</button>
            </div>
        </div>
    </div>
    <div>
        <div class="overall alert" *ngIf="errorAlert==true">
            <div class="cv">
                <span i18n="@@errorprocessing">There was an error on processing your request <br /><br /></span>
                <span>{{error}}</span>
                <div class="icon">
                    <a (click)="closeError()">
                        <img title="compose" src="assets/svg/x.svg">
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>